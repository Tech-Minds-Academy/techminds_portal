<%- include('../../partials/navbar') %>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student News & Updates</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <main class="mx-auto max-w-5xl px-4 pt-24 pb-16">
    <header class="mb-8 text-center">
      <p class="text-xs font-semibold uppercase tracking-wide text-blue-600">Latest from TechMinds</p>
      <h1 class="mt-2 text-3xl font-bold text-slate-900">Student News & Updates</h1>
      <p class="mt-3 text-sm text-slate-600">Stay on top of announcements about classes, events, and opportunities curated by the academy team.</p>
    </header>

    <section id="newsContainer" class="grid gap-4"></section>

    <section id="emptyState" class="hidden rounded-2xl border border-dashed border-slate-300 bg-white p-10 text-center">
      <h2 class="text-lg font-semibold text-slate-800">Nothing to share right now</h2>
      <p class="mt-2 text-sm text-slate-600">Check back soonâ€”new highlights land here first. You can also follow our social channels for quick bites.</p>
    </section>
  </main>

  <template id="newsTemplate">
    <article class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md">
      <div class="flex items-center justify-between gap-3">
        <p class="text-xs font-semibold uppercase tracking-wide text-blue-600" data-category></p>
        <time class="text-xs text-slate-500" data-date></time>
      </div>
      <h2 class="mt-3 text-xl font-semibold text-slate-900" data-title></h2>
      <p class="mt-2 text-sm text-slate-600" data-summary></p>
      <a class="mt-4 inline-flex items-center text-sm font-semibold text-blue-700 hover:text-blue-800" data-link target="_blank" rel="noopener">
        Read more
        <svg class="ml-1 h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M7 17L17 7" />
          <path d="M8 7h9v9" />
        </svg>
      </a>
    </article>
  </template>

  <script>
    async function loadNews() {
      try {
        const response = await fetch('/api/news');
        if (!response.ok) throw new Error('Failed to load news.');
        const items = await response.json();
        const container = document.getElementById('newsContainer');
        const emptyState = document.getElementById('emptyState');
        const template = document.getElementById('newsTemplate');

        if (!Array.isArray(items) || !items.length) {
          emptyState.classList.remove('hidden');
          return;
        }

        const fragment = document.createDocumentFragment();
        items.forEach(item => {
          const node = template.content.cloneNode(true);
          node.querySelector('[data-category]').textContent = item.category || 'Update';
          node.querySelector('[data-date]').textContent = new Date(item.date).toLocaleDateString(undefined, {
            year: 'numeric', month: 'short', day: 'numeric'
          });
          node.querySelector('[data-title]').textContent = item.title;
          node.querySelector('[data-summary]').textContent = item.summary;
          const link = node.querySelector('[data-link]');
          link.href = item.link;
          link.classList.toggle('pointer-events-none', !item.link);
          link.classList.toggle('opacity-60', !item.link);
          link.textContent = item.link ? 'Read more' : 'Details coming soon';
          fragment.appendChild(node);
        });

        container.appendChild(fragment);
      } catch (error) {
        console.error(error);
        const emptyState = document.getElementById('emptyState');
        emptyState.querySelector('h2').textContent = 'We ran into a problem';
        emptyState.querySelector('p').textContent = 'Reload the page or try again later. If the issue continues, contact support.';
        emptyState.classList.remove('hidden');
      }
    }

    loadNews();
  </script>
</body>
</html>
