<%- include('../../partials/navbar') %>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TechMinds â€” Students Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    html { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    .nav-grad { background: linear-gradient(90deg,#1e3a8a,#2563eb,#1e3a8a); }
    .card { background: white; border: 1px solid rgb(226 232 240); }
    .soft { box-shadow: 0 10px 30px -12px rgba(2,6,23,.15); }
    .chip { background: rgba(37,99,235,.1); color: #1d4ed8; }
    .scrollbar::-webkit-scrollbar { height: 8px; width: 8px; }
    .scrollbar::-webkit-scrollbar-thumb { background: rgba(148,163,184,.45); border-radius: 8px; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Topbar -->
  <header class="sticky top-0 z-40 bg-white/85 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4">
      <div class="flex h-16 items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="/assets/Logo.png" alt="TechMinds" class="h-9 w-auto" onerror="this.style.display='none'">
          <h1 class="text-base sm:text-lg font-extrabold text-slate-900">TechMinds Students Dashboard</h1>
        </div>
        <div class="hidden md:flex items-center gap-3">
          <div class="relative">
            <input id="globalSearch" class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm w-72" placeholder="Search courses, lessons, payments"> 
            <span class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-slate-500">/</span>
          </div>
          <button id="notifBtn" class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm">ðŸ””</button>
          <div class="flex items-center gap-2">
            <div id="avatar" class="grid h-8 w-8 place-items-center rounded-full bg-blue-600 text-white text-xs font-semibold">TM</div>
            <span id="welcome" class="text-sm text-slate-700 hidden sm:inline">Welcome, Student</span>
          </div>
        </div>
        <button id="menuBtn" class="md:hidden rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm">Menu</button>
      </div>
    </div>
  </header>

  <!-- Layout -->
  <div class="lg:grid lg:grid-cols-12 lg:gap-4 mx-auto max-w-7xl px-4">
    <!-- Sidebar -->
    <aside id="sidebar" class="lg:col-span-3 hidden lg:block pt-4">
      <nav class="space-y-2">
        <a href="#overview" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Overview</a>
        <a href="#courses" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">My Courses</a>
        <a href="#assignments" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Assignments</a>
        <a href="#schedule" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Schedule</a>
        <a href="#payments" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Payments</a>
        <a href="#profile" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50">Profile</a>
      </nav>
      <div class="mt-4 card rounded-2xl p-4">
        <h3 class="text-sm font-semibold">Quick Links</h3>
        <ul class="mt-2 space-y-2 text-sm">
          <li><a href="/register" class="hover:text-slate-900">Create Account</a></li>
          <li><a href="/forgot" class="hover:text-slate-900">Reset Password</a></li>
          <li><a href="mailto:admissions@techminds.academy" class="hover:text-slate-900">Email Support</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main -->
    <main class="lg:col-span-9 py-6">
      <!-- Overview -->
      <section id="overview" class="space-y-4">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="card rounded-2xl p-4 soft">
            <div class="text-sm text-slate-600">Overall Progress</div>
            <div class="mt-2 text-3xl font-bold" id="overallPct">â€”%</div>
            <div class="mt-3 h-2 w-full rounded-full bg-slate-200"><div id="overallBar" class="h-2 rounded-full bg-blue-600" style="width:0%"></div></div>
          </div>
          <div class="card rounded-2xl p-4 soft">
            <div class="text-sm text-slate-600">Active Courses</div>
            <div class="mt-2 text-3xl font-bold" id="courseCount">0</div>
            <div class="mt-2 text-xs chip inline-block px-2 py-0.5 rounded-full">Updated now</div>
          </div>
          <div class="card rounded-2xl p-4 soft">
            <div class="text-sm text-slate-600">Outstanding Fees (â‚¦)</div>
            <div class="mt-2 text-3xl font-bold" id="outstanding">0</div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="lg:col-span-2 card rounded-2xl p-4 soft">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Announcements</h3>
              <a href="#" class="text-xs text-blue-700" onclick="event.preventDefault()">View all</a>
            </div>
            <ul id="annList" class="space-y-2 text-sm"></ul>
          </div>
          <div class="card rounded-2xl p-4 soft">
            <h3 class="font-semibold mb-2">Next Class</h3>
            <p id="nextClass" class="text-sm text-slate-600">Loadingâ€¦</p>
            <button class="mt-3 rounded-xl bg-blue-600 px-3 py-2 text-sm font-semibold text-white hover:bg-blue-700">Join class</button>
          </div>
        </div>
      </section>

      <!-- Courses -->
      <section id="courses" class="mt-8 space-y-3">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">Your Courses</h3>
          <span id="courseMeta" class="text-xs text-slate-500">â€”</span>
        </div>
        <div id="courseList" class="grid gap-3 sm:grid-cols-2 xl:grid-cols-3"></div>
      </section>

      <!-- Assignments -->
      <section id="assignments" class="mt-8 card rounded-2xl p-4 soft">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-semibold">Assignments Due</h3>
          <a href="#" class="text-xs text-blue-700" onclick="event.preventDefault()">Add</a>
        </div>
        <div class="overflow-x-auto scrollbar">
          <table class="min-w-full text-sm">
            <thead class="text-slate-600">
              <tr class="text-left">
                <th class="py-2 pr-3 font-semibold">Title</th>
                <th class="py-2 pr-3 font-semibold">Course</th>
                <th class="py-2 pr-3 font-semibold">Due</th>
                <th class="py-2 pr-3 font-semibold">Status</th>
                <th class="py-2 font-semibold text-right">Action</th>
              </tr>
            </thead>
            <tbody id="assignBody" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Schedule -->
      <section id="schedule" class="mt-8 card rounded-2xl p-4 soft">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-semibold">This Week's Schedule</h3>
          <div class="text-xs text-slate-500">Africa/Lagos</div>
        </div>
        <ul id="schedList" class="text-sm space-y-2"></ul>
      </section>

      <!-- Payments -->
      <section id="payments" class="mt-8 card rounded-2xl p-4 soft">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-semibold">Payments</h3>
          <div class="text-xs text-slate-500">Demo</div>
        </div>
        <div class="overflow-x-auto scrollbar">
          <table class="min-w-full text-sm">
            <thead class="text-slate-600">
              <tr class="text-left">
                <th class="py-2 pr-3 font-semibold">Invoice</th>
                <th class="py-2 pr-3 font-semibold">Course</th>
                <th class="py-2 pr-3 font-semibold">Amount (â‚¦)</th>
                <th class="py-2 pr-3 font-semibold">Status</th>
                <th class="py-2 font-semibold text-right">Action</th>
              </tr>
            </thead>
            <tbody id="payBody" class="divide-y divide-slate-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Profile -->
      <section id="profile" class="mt-8 card rounded-2xl p-4 soft">
        <h3 class="font-semibold mb-3">Profile</h3>
        <form id="profileForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4" novalidate>
          <div>
            <label class="text-sm mb-1" for="fullName">Full name</label>
            <input id="fullName" name="fullName" type="text" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm" placeholder="e.g. Adaeze Okoye" />
          </div>
          <div>
            <label class="text-sm mb-1" for="email">Email</label>
            <input id="email" name="email" type="email" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm" placeholder="you@example.com" />
          </div>
          <div>
            <label class="text-sm mb-1" for="phone">Phone</label>
            <input id="phone" name="phone" type="tel" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm" placeholder="0802 123 4567" />
          </div>
          <div>
            <label class="text-sm mb-1" for="username">Username</label>
            <input id="username" name="username" type="text" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm" placeholder="ada.okoye" />
          </div>
          <div class="sm:col-span-2 flex items-center justify-between pt-2">
            <button type="button" id="resetProfile" class="rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm hover:bg-slate-50">Reset</button>
            <button type="submit" class="rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700">Save changes</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <footer class="mt-6 border-t border-slate-200 bg-white">
    <div class="mx-auto max-w-7xl px-4 py-6 text-sm text-slate-600">Â© <span id="year"></span> TechMinds Academy</div>
  </footer>

  <script>
    const $ = (s, e=document) => e.querySelector(s);
    const $$ = (s, e=document) => Array.from(e.querySelectorAll(s));
    const money = (n) => n.toLocaleString('en-NG');
    const initials = (name) => (name||'TM').split(/\s+/).map(x=>x[0]).slice(0,2).join('').toUpperCase();

    // Demo data
    const student = JSON.parse(localStorage.getItem('tma_student')||'null') || { fullName:'Adaeze Okoye', email:'adaeze@example.com', phone:'0802 123 4567', username:'ada.okoye' };
    const courses = [
      { id:'web', name:'Web Development', progress:62, next:'Mon 10:00' },
      { id:'data', name:'Data & Analytics', progress:35, next:'Tue 17:30' },
      { id:'cloud', name:'Cloud Computing', progress:80, next:'Sat 11:00' },
    ];
    const assignments = [
      { title:'HTML Semantics', course:'Web Development', due:'Fri, 24 Oct', status:'Pending' },
      { title:'SQL Joins Lab', course:'Data & Analytics', due:'Sun, 26 Oct', status:'Review' },
      { title:'VPC Setup', course:'Cloud Computing', due:'Mon, 27 Oct', status:'Pending' },
    ];
    const payments = [
      { id:'INV-2451', course:'Web Development', amount:120000, status:'Paid' },
      { id:'INV-2492', course:'Data & Analytics', amount:95000, status:'Pending' },
      { id:'INV-2510', course:'Cloud Computing', amount:110000, status:'Paid' },
    ];
    const schedule = [
      { day:'Mon', time:'10:00', what:'Web Dev â€¢ Live' },
      { day:'Tue', time:'17:30', what:'Data â€¢ Lab' },
      { day:'Sat', time:'11:00', what:'Cloud â€¢ Workshop' },
    ];
    const anns = [
      'Wiâ€‘Fi maintenance Friday 6â€“8pm.',
      'Upload Week 4 project repo before Sunday night.',
      'Career session with alumni Saturday 2pm (online).'
    ];

    // Header
    $('#year').textContent = new Date().getFullYear();
    $('#welcome').textContent = `Welcome, ${student.fullName.split(' ')[0]}`;
    $('#avatar').textContent = initials(student.fullName);

    // Sidebar toggle for mobile
    const menuBtn = $('#menuBtn');
    const sidebar = $('#sidebar');
    menuBtn && menuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('hidden');
    });

    // Populate metrics
    $('#courseCount').textContent = String(courses.length);
    const overall = Math.round(courses.reduce((a,c)=>a+c.progress,0)/courses.length);
    $('#overallPct').textContent = overall + '%';
    $('#overallBar').style.width = overall + '%';
    const outstanding = payments.filter(p=>p.status==='Pending').reduce((a,p)=>a+p.amount,0);
    $('#outstanding').textContent = money(outstanding);

    // Announcements
    const annUL = $('#annList');
    anns.forEach(t=>{ const li=document.createElement('li'); li.className='rounded-lg border border-slate-200 p-3'; li.textContent=t; annUL.appendChild(li); });

    // Next class
    $('#nextClass').textContent = courses[0] ? `${courses[0].name} â€¢ ${courses[0].next}` : 'No class scheduled';

    // Courses list
    const courseList = $('#courseList');
    courses.forEach(c=>{
      const el = document.createElement('article');
      el.className = 'card rounded-2xl p-4';
      el.innerHTML = `
        <div class="flex items-center justify-between">
          <h4 class="font-semibold">${c.name}</h4>
          <span class="text-xs text-slate-500">Next: ${c.next}</span>
        </div>
        <div class="mt-3 h-2 w-full rounded-full bg-slate-200">
          <div class="h-2 rounded-full bg-blue-600" style="width:${c.progress}%"></div>
        </div>
        <div class="mt-2 text-sm text-slate-600">Progress: ${c.progress}%</div>
        <div class="mt-3 flex gap-2">
          <button class="rounded-xl bg-blue-600 px-3 py-2 text-xs font-semibold text-white hover:bg-blue-700">Continue</button>
          <button class="rounded-xl border border-slate-300 px-3 py-2 text-xs hover:bg-slate-50">Resources</button>
        </div>`;
      courseList.appendChild(el);
    });
    $('#courseMeta').textContent = `${courses.length} courses`;

    // Assignments table
    const assignBody = $('#assignBody');
    assignments.forEach(a=>{
      const tr=document.createElement('tr');
      const pill = a.status==='Pending' ? 'bg-yellow-100 text-yellow-700' : a.status==='Review' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
      tr.innerHTML = `
        <td class="py-2 pr-3">${a.title}</td>
        <td class="py-2 pr-3">${a.course}</td>
        <td class="py-2 pr-3">${a.due}</td>
        <td class="py-2 pr-3"><span class="px-2 py-0.5 rounded-full text-xs ${pill}">${a.status}</span></td>
        <td class="py-2 text-right"><button class="rounded-md border border-slate-300 px-2 py-1 text-xs hover:bg-slate-50">Open</button></td>`;
      assignBody.appendChild(tr);
    });

    // Schedule
    const schedList = $('#schedList');
    schedule.forEach(s=>{ const li=document.createElement('li'); li.className='rounded-lg border border-slate-200 p-3'; li.textContent=`${s.day} ${s.time} â€” ${s.what}`; schedList.appendChild(li); });

    // Payments
    const payBody = $('#payBody');
    payments.forEach(p=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td class="py-2 pr-3">${p.id}</td>
        <td class="py-2 pr-3">${p.course}</td>
        <td class="py-2 pr-3">${money(p.amount)}</td>
        <td class="py-2 pr-3">${p.status}</td>
        <td class="py-2 text-right">
          <button class="rounded-xl ${p.status==='Paid' ? 'border border-slate-300 bg-white text-slate-500 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700'} px-3 py-2 text-xs">${p.status==='Paid' ? 'Paid' : 'Pay now'}</button>
        </td>`;
      payBody.appendChild(tr);
    });

    // Profile form binds to localStorage (shared with other pages you built earlier)
    $('#fullName').value = student.fullName;
    $('#email').value = student.email;
    $('#phone').value = student.phone;
    $('#username').value = student.username;

    $('#profileForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.currentTarget).entries());
      localStorage.setItem('tma_student', JSON.stringify(data));
      $('#welcome').textContent = `Welcome, ${data.fullName.split(' ')[0] || 'Student'}`;
      $('#avatar').textContent = initials(data.fullName);
      alert('Saved');
    });

    $('#resetProfile').addEventListener('click', () => {
      localStorage.removeItem('tma_student');
      location.reload();
    });

    // Global search demo (filters course cards & assignments)
    $('#globalSearch')?.addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      $$('#courseList article').forEach(el => el.classList.toggle('hidden', !el.textContent.toLowerCase().includes(q)));
      $$('#assignBody tr').forEach(el => el.classList.toggle('hidden', !el.textContent.toLowerCase().includes(q)));
    });

    // Keyboard: focus search with /
    document.addEventListener('keydown', (e)=>{ if(e.key==='/' && document.activeElement.tagName!=='INPUT' && document.activeElement.tagName!=='TEXTAREA'){ e.preventDefault(); $('#globalSearch')?.focus(); } });
  </script>
</body>
</html>